<html><head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<style>
    
        html {
            background-color: #1c1c1c;
            color: white;
            font-family: 'Roboto', sans-serif;
        }
        
        #content {
            position: fixed;
            top: 50%;
            left: 50%;
            /* bring your own prefixes */
            transform: translate(-50%, -50%);
        }
        
        #upload-file {
            width: 400px;
            height: 100px;
            box-shadow:inset 0px 34px 0px -15px #b54b3a;
            background-color:#a73f2d;
            border:1px solid #241d13;
            display:inline-block;
            cursor:pointer;
            color:#ffffff;
            font-family:Arial;
            font-size:30px;
            font-weight:bold;
            padding:9px 23px;
            text-decoration:none;
            text-shadow:0px -1px 0px #7a2a1d;
        }

        #upload-file:hover {
            background-color:#b34332;
        }
        #upload-file:active {
            position:relative;
            top:1px;
        }

        
    </style>
    
    </head><body>
        <input type="file" id="open-file" style="display: none;">
        <div id="content">
            <center>
            <h1>MailChimp Cleaner</h1>
            <h2>by Marcelo Cubillos, hosted via GitHub</h2><br><br>
            </center>
            <p>If youâ€™ve ever tried emailing an HTML file generated by MailChimp, you might have noticed that the body of the email sometimes contains leftover text, such as:</p>
            <ul>
                <li>*|MC:SUBJECT|*</li>
                <li>*|IF:MC_PREVIEW_TEXT|*</li>
                <li>*|MC_PREVIEW_TEXT|*</li>
            </ul>
            <p>This app takes HTML files generated by MailChimp and removes any associated data from it.</p><br><br>
            <center>
            <input type="button" id="upload-file" value="UPLOAD HTML FILE" onclick="document.getElementById('open-file').click();">
            <p>I'm nostalgic for late-2000's web aesthetics.</p>
            </center>
        </div>
        
        <script>
            function openFile(e)
            {
                var file = e.target.files[0];
                let name = e.target.files[0].name;
                name = name.slice(0, name.length - 5);
                if(!file)
                {
                    return;
                }
                var reader = new FileReader();
                reader.onload = function(e)
                {
                    var contents = e.target.result;
                    removeHeaders(name, contents);
                }
                reader.readAsText(file);
            }
            
            const downloadToFile = (content, filename, contentType) => {
                const a = document.createElement('a');
                const file = new Blob([content], {type: contentType});

                a.href= URL.createObjectURL(file);
                a.download = filename;
                a.click();

                URL.revokeObjectURL(a.href);
            };
            
            function removeHeaders(name, contents)
            {
                const headers = new Array();
                headers.push("<meta charset=\"UTF-8\">");
                headers.push("<title>*|MC:SUBJECT|*</title>");
                headers.push("<!--*|IF:MC_PREVIEW_TEXT|*-->");
                headers.push("*|MC_PREVIEW_TEXT|*");
                
                let lines = contents.split('\n');
                let new_content = new String();
                for(let i = 0; i < lines.length; i++)
                {
                    let contains = false;
                    
                    for(let j = 0; j < headers.length; j++)
                    {
                        if(lines[i].includes(headers[j]))
                        {
                            contains = true;
                            break;
                        }
                    }
                    
                    if(!contains)
                    {
                        new_content += lines[i] + "\n";
                    }
                    
                    if(i == 1)
                    {
                        new_content += "<!-- File modified by Remove MC Headers. Visit https://marcelocubillos.com/remove-mc-headers/ for more information. -->\n";
                    }
                }
                
                downloadToFile(new_content, `${name}_removed.html`, 'text/plain')
            }
            
            document.getElementById("open-file").addEventListener("change", openFile, false);
            
        </script>
    
    
    
</body></html>